library(tidyverse)
library(ggplot2)
ridership_data <- read.csv("~/Desktop/PHP1560/final.data/ridership_simulated.csv")
otp_data <- read.csv("~/Desktop/PHP1560/final.data/otp_simulated (2).csv")
View(ridership_data)
View(ridership_data)
View(otp_data)
View(otp_data)
table(ridership_data$Route)
table(ridership_data$Route, otp_data$route)
table(ridership_data$Route, otp_data$Route)
unique(ridership_data$Route)
unique(otp_data$Route)
arrange(otp_data$Route))
arrange(otp_data$Route)
otp_data <- otp_data %>% arrange(Route)
unique(ridership_data$Route)
unique(otp_data$Route)
otp_data <- otp_data %>%
arrange(Route)
ridership_data <- ridership_data %>%
filter(Route = unique(otp_data$Route))
otp_data <- otp_data %>%
arrange(Route)
ridership_data <- ridership_data %>%
filter(Route == unique(otp_data$Route))
unique <- unique(otp_data$Route)
ridership_data <- ridership_data %>%
filter(Route %in% unique(otp_data$Route))
unique(otp_data$Route)
unique(ridership_data$Route)
View(otp_data)
otp_data <- otp_data %>%
subset(otp_data, select = - c(Driver.ID, Stop, Stop.Sequence, StopLat, StopLng))
otp_data <- subset(otp_data, select = - c(Driver.ID, Stop, Stop.Sequence, StopLat, StopLng))
View(otp_data)
# mutating ridership data to only include needed variables
ridership_data <- subset(ridership_data, select = c(Time, Day.of.Week, Route,
Type, College,
High.School, Low.Income))
ridership_data <- pivot_wider(ridership_data, names_from = Type)
ridership_data <- pivot_wider(ridership_data, names_from = c("Child, Adult,
Disabled, Senior"),
values_from = "Type")
ridership_data <- mutate(Child = ifelse(Type = Child, 1, 0)
ridership_data <- mutate(Child = ifelse(Type = Child, 1, 0))
ridership_data <- ridership_data %>%
mutate(Child = ifelse(Type = Child, 1, 0))
ridership_data <- ridership_data %>%
mutate(Child = ifelse(Type == Child, 1, 0))
ridership_data <- ridership_data %>%
mutate(Child = ifelse(Child %in% Type, 1, 0))
ridership_data <- ridership_data %>%
mutate(Child == ifelse(Child %in% Type, 1, 0))
ridership_data <- ridership_data %>%
mutate(Child == ifelse("Child" %in% Type, 1, 0))
ridership_data <- ridership_data %>%
mutate(Child = ifelse("Child" %in% Type, 1, 0))
ridership_data <- ridership_data %>%
mutate(Child = ifelse("Child" %in% "Type", 1, 0))
ridership_data <- ridership_data %>%
mutate(Child = ifelse(Child %in% Type, 1, 0))
ridership_data <- ridership_data %>%
mutate(Child = ifelse(Child %in% Type, 1, 0))
ridership_data <- ridership_data %>%
mutate(Child_flag = ifelse(Child %in% Type, 1, 0))
# Step 0: loading & cleaning datasets
# Step 2: Mutating columns of simulated ridership data
library(tidyverse)
library(ggplot2)
ridership_data <- read.csv("~/Desktop/PHP1560/final.data/ridership_simulated.csv")
otp_data <- read.csv("~/Desktop/PHP1560/final.data/otp_simulated (2).csv")
# arranging in order of routes
otp_data <- otp_data %>%
arrange(Route)
# filtering so that we only include routes that are in both datasets
ridership_data <- ridership_data %>%
filter(Route %in% unique(otp_data$Route))
# checking to make sure filtering worked!
unique(otp_data$Route)
unique(ridership_data$Route)
# mutating OTP data to only include needed variables
otp_data <- subset(otp_data, select = - c(Driver.ID, Stop, Stop.Sequence,
StopLat, StopLng))
# mutating ridership data to only include needed variables
ridership_data <- subset(ridership_data, select = c(Time, Day.of.Week, Route,
Type, College,
High.School, Low.Income))
ridership_data <- pivot_wider(ridership_data, names_from = Type, values_from = 0)
?pivot_wider
ridership_data<- ridership_data %>%
mutate(value = 1) %>%
pivot_wider(names_from = type, values_from = value, values_fill = 0)
ridership_data<- ridership_data %>%
mutate(value = 1) %>%
pivot_wider(names_from = Type, values_from = value, values_fill = 0)
rlang::last_trace()
?mutate
?case_when
ridership_data <- ridership_data %>%
mutate(Child = case_when(Child %in% Type))
ridership_data <- ridership_data %>%
mutate(Child = case_when(Type = Child))
ridership_data <- ridership_data %>%
mutate(Child = case_when(Type == Child))
ridership_data <- ridership_data %>%
mutate(Child =
if((Type == Child){Child = 1} else{Child=0}
ridership_data <- ridership_data %>%
mutate(Child =
if((Type == Child){Child = 1} else{Child=0})
ridership_data <- ridership_data %>%
mutate(Child = if_else(Type == "Child", 1, 0))
ridership_data <- ridership_data %>%
mutate(Child = if_else(Type == "Child", 1, 0)) %>%
mutate(Senior = if_else(Type == "Senior", 1, 0)) %>%
mutate(Disabled = if_else(Type == "Disabled", 1, 0))
library(tidyverse)
library(ggplot2)
ridership_data <- read.csv("~/Desktop/PHP1560/final.data/ridership_simulated.csv")
otp_data <- read.csv("~/Desktop/PHP1560/final.data/otp_simulated (2).csv")
# arranging in order of routes
otp_data <- otp_data %>%
arrange(Route)
# filtering so that we only include routes that are in both datasets
ridership_data <- ridership_data %>%
filter(Route %in% unique(otp_data$Route))
# checking to make sure filtering worked!
unique(otp_data$Route)
unique(ridership_data$Route)
# mutating OTP data to only include needed variables
otp_data <- subset(otp_data, select = - c(Driver.ID, Stop, Stop.Sequence,
StopLat, StopLng))
# mutating ridership data to only include needed variables
ridership_data <- subset(ridership_data, select = c(Time, Day.of.Week, Route,
Type, College,
High.School, Low.Income))
View(ridership_data)
ridership_data <- ridership_data %>%
mutate(Child = if_else(Type == "Child", 1, 0)) %>%
mutate(Senior = if_else(Type == "Senior", 1, 0)) %>%
mutate(Disabled = if_else(Type == "Disabled", 1, 0)) %>%
mutate(Brown_RISD = if_else(College == "Brown" | "RISD", 1, 0))  %>%
mutate(Other_College = if_else(College != "None" | "Brown" | "RISD", 1, 0)))
ridership_data <- ridership_data %>%
mutate(Child = if_else(Type == "Child", 1, 0)) %>%
mutate(Senior = if_else(Type == "Senior", 1, 0)) %>%
mutate(Disabled = if_else(Type == "Disabled", 1, 0)) %>%
mutate(Brown_RISD = if_else(College == "Brown" | "RISD", 1, 0))  %>%
mutate(Other_College = if_else(College != "None" | "Brown" | "RISD", 1, 0))
ridership_data <- ridership_data %>%
mutate(Child = if_else(Type == "Child", 1, 0)) %>%
mutate(Senior = if_else(Type == "Senior", 1, 0)) %>%
mutate(Disabled = if_else(Type == "Disabled", 1, 0)) %>%
mutate(Brown_RISD = if_else(College == "Brown" | College ==  "RISD", 1, 0))  %>%
mutate(Other_College = if_else(College == "None" | College != "Brown" |
College != "RISD", 1, 0))
View(ridership_data)
View(otp_data)
ridership_data <- ridership_data %>%
mutate(Child = if_else(Type == "Child", 1, 0)) %>%
mutate(Senior = if_else(Type == "Senior", 1, 0)) %>%
mutate(Disabled = if_else(Type == "Disabled", 1, 0)) %>%
mutate(Brown_RISD = if_else(College == "Brown" | College ==  "RISD", 1, 0))  %>%
mutate(Other_College = if_else(College == "None" | College != "Brown" |
College != "RISD", 1, 0)) %>%
mutate(High_School = if_else(High.School != "None", 1, 0))
View(ridership_data)
ridership_data <- subset(ridership_data, select = c(Time, Day.of.Week, Route,
Low.Income, Child, Senior,
Disabled, Brown_RISD,
Other_College, High_School))
View(ridership_data)
View(otp_data)
otp_data <- subset(otp_data, select = - c(Driver.ID, Trip, Stop, Stop.Sequence,
StopLat, StopLng))
otp_data <- subset(otp_data, select = - c(Trip))
View(ridership_data)
View(otp_data)
View(ridership_data)
library(tidyverse)
library(ggplot2)
ridership_data <- read.csv("~/Desktop/PHP1560/final.data/ridership_simulated.csv")
otp_data <- read.csv("~/Desktop/PHP1560/final.data/otp_simulated (2).csv")
# arranging in order of routes
otp_data <- otp_data %>%
arrange(Route)
# filtering so that we only include routes that are in both datasets
ridership_data <- ridership_data %>%
filter(Route %in% unique(otp_data$Route))
# checking to make sure filtering worked!
unique(otp_data$Route)
unique(ridership_data$Route)
# mutating OTP data to only include needed variables
otp_data <- subset(otp_data, select = - c(Driver.ID, Trip, Stop, Stop.Sequence,
StopLat, StopLng))
# mutating ridership data to only include needed variables
ridership_data <- subset(ridership_data, select = c(Time, Day.of.Week, Route,
Type, College,
High.School, Low.Income))
ridership_data <- ridership_data %>%
mutate(Child = if_else(Type == "Child", 1, 0)) %>%
mutate(Senior = if_else(Type == "Senior", 1, 0)) %>%
mutate(Disabled = if_else(Type == "Disabled", 1, 0)) %>%
mutate(Brown_RISD = if_else(College == "Brown" | College ==  "RISD", 1, 0))  %>%
mutate(Other_College = if_else(College != "None" | College != "Brown" |
College != "RISD", 1, 0)) %>%
mutate(High_School = if_else(High.School != "None", 1, 0))
ridership_data <- subset(ridership_data, select = c(Time, Day.of.Week, Route,
Low.Income, Child, Senior,
Disabled, Brown_RISD,
Other_College, High_School))
View(ridership_data)
View(otp_data)
View(ridership_data)
View(otp_data)
otp_data <- otp_data %>%
mutate(OnTime == case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
-60 < Delay.Sec > 300 ~ "On Time")
otp_data <- otp_data %>%
mutate(OnTime == case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 && Delay.Sec < 300 ~  "On Time")
)
View(ridership_data)
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 && Delay.Sec < 300 ~  "On Time")
)
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 && < 300 ~  "On Time")
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 && Delay.Sec < 300 ~  "On Time")
)
View(otp_data)
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
)
View(otp_data)
View(ridership_data)
View(otp_data)
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
) %>%
group_by(Route)
View(otp_data)
?summarize
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
) %>%
group_by(Route) %>%
for (Route in i:95){
summarize(n_row("Early" %in% Delay.Sec)/n())
}
View(otp_data)
for(Route in i:max(Route)){
filter(Route == i)
summarize(share_early == n_row(Delay.Sec == "Early")/n())
summarize(share_on_time == n_row(Delay.Sec == "On Time")/n())
summarize(share_late == n_row(Delay.Sec == "Late")/n())
}
for(i in 1:max(Route)){
filter(Route == i)
summarize(share_early == n_row(Delay.Sec == "Early")/n())
summarize(share_on_time == n_row(Delay.Sec == "On Time")/n())
summarize(share_late == n_row(Delay.Sec == "Late")/n())
}
View(ridership_data)
route_performance <- function(data = otp_data){
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
) %>%
group_by(Route) %>%
for(i in 1:max(Route)){
filter(Route == i)
summarize(share_early == n_row(Delay.Sec == "Early")/n())
summarize(share_on_time == n_row(Delay.Sec == "On Time")/n())
summarize(share_late == n_row(Delay.Sec == "Late")/n())
}
}
View(otp_data)
route_performance <- function(data = otp_data){
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
) %>%
group_by(Route) %>%
for(i in 1:max(Route)){
route_data <- filter(Route == i) %>%
summarize(share_early == n_row(Delay.Sec == "Early")/n()) %>%
summarize(share_on_time == n_row(Delay.Sec == "On Time")/n()) %>%
summarize(share_late == n_row(Delay.Sec == "Late")/n())
}
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
) %>%
group_by(Route) %>%
for(i in 1:max(Route)){
route_data <- filter(Route == i) %>%
summarize(share_early == n_row(Delay.Sec == "Early")/n()) %>%
summarize(share_on_time == n_row(Delay.Sec == "On Time")/n()) %>%
summarize(share_late == n_row(Delay.Sec == "Late")/n())
}
View(otp_data)
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
) %>%
group_by(Route) %>%
for(i in 1:max(Route)){
route_data <- otp_data %>%
filter(Route == i) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n()) %>%
summarize(share_on_time == sum(Delay.Sec == "On Time")/n()) %>%
summarize(share_late == sum(Delay.Sec == "Late")/n())
}
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
) %>%
group_by(Route) %>%
for(i in 1:max(Route)){
route_data <- otp_data %>%
filter(Route == i) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n()) %>%
summarize(share_on_time == sum(Delay.Sec == "On Time")/n()) %>%
summarize(share_late == sum(Delay.Sec == "Late")/n())
}
View(otp_data)
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
) %>%
group_by(Route) %>%
for(i in 1:max(Route)){
route_data <- otp_data %>%
filter(Route == i) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n()) %>%
summarize(share_on_time == sum(Delay.Sec == "On Time")/n()) %>%
summarize(share_late == sum(Delay.Sec == "Late")/n())
results[i] <- route_data
}
results <- bind_rows(results)
results <- list() %>%
for(i in 1:max(Route)){
route_data <- otp_data %>%
filter(Route == i) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n()) %>%
summarize(share_on_time == sum(Delay.Sec == "On Time")/n()) %>%
summarize(share_late == sum(Delay.Sec == "Late")/n())
results[i] <- route_data
}
results <- bind_rows(results)
results <- list()
for(i in 1:max(Route)){
route_data <- otp_data %>%
filter(Route == i) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n()) %>%
summarize(share_on_time == sum(Delay.Sec == "On Time")/n()) %>%
summarize(share_late == sum(Delay.Sec == "Late")/n())
results[i] <- route_data
}
results <- bind_rows(results)
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
) %>%
group_by(Route) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n(),
share_on_time == sum(Delay.Sec == "On Time")/n(),
share_late == sum(Delay.Sec == "Late")/n())
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
) %>%
group_by(Route) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n(),
share_on_time == sum(Delay.Sec == "On Time")/n(),
share_late == sum(Delay.Sec == "Late")/n())
performance <- otp_data %>%
group_by(Route) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n(),
share_on_time == sum(Delay.Sec == "On Time")/n(),
share_late == sum(Delay.Sec == "Late")/n())
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
)
performance <- otp_data %>%
group_by(Route) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n(),
share_on_time == sum(Delay.Sec == "On Time")/n(),
share_late == sum(Delay.Sec == "Late")/n())
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
)
performance <- otp_data %>%
group_by(Route) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n(),
share_on_time == sum(Delay.Sec == "On Time")/n(),
share_late == sum(Delay.Sec == "Late")/n())
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
)
performance <- otp_data %>%
group_by(Route) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n(),
share_on_time == sum(Delay.Sec == "On Time")/n(),
share_late == sum(Delay.Sec == "Late")/n())
otp_data <- otp_data %>%
mutate(OnTime = case_when(Delay.Sec <= -60 ~ "Early",
Delay.Sec >= 300 ~ "Late",
Delay.Sec > -60 & Delay.Sec < 300 ~  "On Time")
)
performance <- otp_data %>%
group_by(Route) %>%
summarize(share_early == sum(Delay.Sec == "Early")/n(),
share_on_time == sum(Delay.Sec == "On Time")/n(),
share_late == sum(Delay.Sec == "Late")/n())
View(otp_data)
View(otp_data)
View(otp_data)
View(otp_data)
# Step 0: loading & cleaning datasets
# Step 2: Mutating columns of simulated ridership data
library(tidyverse)
library(ggplot2)
ridership_data <- read.csv("~/Desktop/PHP1560/final.data/ridership_simulated.csv")
otp_data <- read.csv("~/Desktop/PHP1560/final.data/otp_simulated (2).csv")
# arranging in order of routes
otp_data_updated <- otp_data %>%
arrange(Route)
# filtering so that we only include routes that are in both datasets
ridership_data <- ridership_data %>%
filter(Route %in% unique(otp_data_updated$Route))
# checking to make sure filtering worked!
unique(otp_data_updated$Route)
unique(ridership_data$Route)
# mutating OTP data to only include needed variables
otp_data_updated <- subset(otp_data, select = - c(Driver.ID, Trip, Stop, Stop.Sequence,
StopLat, StopLng))
# mutating ridership data to only include needed variables
ridership_data_updated <- subset(ridership_data, select = c(Time, Day.of.Week, Route,
Type, College,
High.School, Low.Income))
ridership_data_updated <- ridership_data_updated  %>%
mutate(Child = if_else(Type == "Child", 1, 0)) %>%
mutate(Senior = if_else(Type == "Senior", 1, 0)) %>%
mutate(Disabled = if_else(Type == "Disabled", 1, 0)) %>%
mutate(Brown_RISD = if_else(College == "Brown" | College ==  "RISD", 1, 0))  %>%
mutate(Other_College = if_else(College != "None" & College != "Brown" &
College != "RISD", 1, 0)) %>%
mutate(High_School = if_else(High.School != "None", 1, 0))
ridership_data_updated  <- subset(ridership_data_updated, select = c(Time, Day.of.Week, Route,
Low.Income, Child, Senior,
Disabled, Brown_RISD,
Other_College, High_School))
# visualize percentage of overall riders who fit categories
for_vis_ridership <- ridership_data_updated %>%
pivot_longer(cols = c(Child, Senior, Disabled, Low.Income,
High_School, Brown_RISD, Other_College),
names_to = "Demographics",
values_to = "Yes_or_No")
plot_data <- for_vis_ridership %>%
group_by(Demographics) %>%
summarize(yes_rate = mean(Yes_or_No == 1))
plot <- ggplot(plot_data) +
geom_col(aes(x = Demographics, y = yes_rate), fill = "#FFB3FF") +
theme_minimal() +
labs(title = "Demographic Breakdown of RIPTA Riders", x = " ", y =
"Share of Riders") +
scale_x_discrete(labels = c("Brown-RISD \nStudents", "Child", "Disabled",
"High School \nStudents", "Low Income",
"Other College \nStudents", "School")) +
theme(axis.text.x = element_text(angle = 60, hjust = 1), fill) +
scale_y_continuous(labels = c("0", "5%", "10%", "15%"),
breaks = c(0.0, 0.05, 0.1, 0.15))
ggsave("demographic_ridership.png", plot = plot, width = 6, height = 4,
dpi = 300)
View(otp_data)
?t.test
?full_join
